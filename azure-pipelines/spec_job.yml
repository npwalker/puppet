parameters:
  name: ''
  spec_command: ''
  ruby_version: ''
  puppet_gem_version: ''

jobs:
- job: ${{ parameters.name }}
  pool:
    vmImage: 'ubuntu-16.04'
  steps:
  - task: UseRubyVersion@0
    inputs:
      versionSpec: ${{ parameters.ruby_version }}
      addToPath: true # Optional
  - script: |
      bundle -v
      gem update --system $RUBYGEMS_VERSION --no-document
      #&& gem install bundler --no-document #this step fails for unknown reasons atm
    displayName: 'gem update'
  - script: |
      gem --version
      bundle -v
      bundle install --jobs $(nproc) --path vendor/bundle --retry 2 --without packaging documentation
    displayName: 'bundle install'
  - script: bundle exec rake ${{ parameters.spec_command }}
    displayName: 'bundle exec rake ${{ parameters.spec_command }}'
